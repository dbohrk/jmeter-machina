## Machina API Performance Tests
Machina API performance tests are designed using JMeter for flexibility and low maintenance. The objective is to measure both the performance of each API and of each API with Policy Engine decision using a parallel Keyless Policy decision load. This approach can identify scenarios where an API request is impacting Policy decision performance.
## Installaton

 - [Download and Install JMeter from Apache.org](https://jmeter.apache.org/download_jmeter)
 - [Clone Machina-API](https://stash.in.ionicsecurity.com/scm/qa/performance.git) in the QA/Performance Stash directory

The Machina-API directory needs to be in this structure:

+ machina-api
	+ config
	+ data
	+ jmeter
	+ jmx
	+ reports
	+ suites

+ The config directory contains the machinaConfig.csv file with Machina server name, tenant id, bearer token, and other parameters that are needed by some JMeter thread groups.
+ The data directory contains .csv files from JMeter thread group execition.
+ The jmeter directory contains the JMeter execution scripts. These scripts need to be executed from the root directory, machina-api.
+ The jmx directory contains all of the JMeter test plans. Test plan is the JMeter term for a collection of thread groups. Thread groups are the actual tests that are executed by JMeter.
+ The reports directory contains all of the html reports generated by JMeter for each test run.
+ The suites directory contains scripts that execute groups, or suites, of JMeter tests. They call scripts in the jmeter directory and need to be executed from the root diretory, machina-api.
## Execution
Work from, and start any interactive sessions of JMeter, from the machina-api directory. References to machinaConfig.csv are relative to the machinaAPI directory. Using another directory may cause JMeter to exit without executing any tests beacuse of a missing configuration file.

Wrapper scripts in the jmeter directory handle invoking JMeter, collecting data, and producing reports; these scripts need to be executed from the root directory, machina-api. The wrapper scripts are organized by JMeter test plan. Use the -h command line option for a list of available test threads and an explaination of options.

Command line arguments for scripts in the jmeter directory are:

-u <number of users>. Default number of users is 0.
-s <runtime in seconds>. Default runtime is 0 seconds.
-r <ramp-up time in seconds>. Default ramp-up time is 0 seconds.
-t <thread group name>. Required. Thread Groups available:
-p Execute second run of Thread Group with keylessDecision in KeylessDecision
-P Only exexute run of Thread Group with keylessDecision in KeylessDecision
-t Thread Group name

## Reporting
Reports are in the reports directory and are named by the thread group executed. If a thread group was executed with Keyless Decision in prarllel there will be two report directories; one name with the thread group name and "-with-keylessDecision" and the other with "keylessDecision-with-" prepended to the threadgroup.

Open index.html with a browser in the directory corresponding to the test execution.

Scripts in the suits directory provide a method of executing groups of JMeter tests; they must be executed from the root directory, machina-api.
